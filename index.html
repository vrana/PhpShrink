<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
<title>PhpShrink</title>
<meta name="viewport" content="initial-scale=1">
<body>

<h1>PhpShrink</h1>

<ul>
<li><a href="https://github.com/vrana/PhpShrink">PhpShrink GitHub</a>
<li>This page uses <a href="https://php-wasm.seanmorr.is/getting-started/home.html">Php-Wasm</a>
</ul>

<form action="" method="post">
<p><textarea id="input" name="input" rows="30" cols="120">&lt;?php
$abc = 1;
// prints 1
echo $abc;
</textarea>
</form>

<div id="output"></div>

<script type="text/javascript">
let highlightShrink;
(async function () {
	const { PhpWeb } = await import('https://cdn.jsdelivr.net/npm/php-wasm@0.0.9-alpha-29/PhpWeb.mjs');
	php = new PhpWeb({files: [
		{name: 'phpShrink.php', url: 'https://raw.githubusercontent.com/vrana/PhpShrink/refs/heads/main/phpShrink.php'}
	]});
	php.addEventListener('output', event => console.log(event.detail));
	php.addEventListener('error',  event => console.error(event.detail));
	await php.run(`<?php include "./phpShrink.php"; ?>`);
	highlightShrink = await php.x`function ($input) { return highlight_string(phpShrink($input), true); }`;
	shrink();
	document.getElementById('input').oninput = shrink;
})();

function shrink() {
	document.getElementById('output').innerHTML = highlightShrink(document.getElementById('input').value);
}
</script>
